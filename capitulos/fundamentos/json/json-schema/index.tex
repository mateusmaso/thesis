\subsection[JSON Schema]{JSON Schema}

JSON Schema é uma linguagem de definição projetada para descrever estruturas de dados JSON por meio de esquemas. Foi proposta em 2009 por Kris Zyp com objetivo de fornecer um contrato para que aplicações soubessem como trabalhar e interagir com certas estruturas de dados. Por meio deste, é possível prever representações e assim realizar operações de validação, documentação, navegação de hyperlink e controle de iteração.

Por ser uma linguagem de simples uso, para representar um esquema basta construir um objeto JSON utilizando um subconjunto válido de chaves especias descritas pela linguagem. No entanto, funcionalidades como descrição de estruturas multimídia\footnote{
  Imagens, videos, audio digital.
} e a navegação de dados através de hyperlinks são apenas disponibilizadas no formato JSON Hyper-Schema, uma variação da linguagem de especificação. \cite{Jackson2016}

\begin{figure}[H]
  \centering
  \inputminted[frame=single,framesep=10pt]{javascript}{anexos/pessoa-schema.json}
  \caption{Exemplo de JSON Schema para Figura 3}
\end{figure}

\begin{figure}[H]
  \centering
  \inputminted[frame=single,framesep=10pt]{javascript}{anexos/pessoa-hyper-schema.json}
  \caption{Exemplo de JSON Hyper-Schema para Figura 3}
\end{figure}

Com base nos esquemas especificados pelas figuras 5 e 6, ambos asseguram que, dado uma estrutura JSON, para que esta seja reconhecido como uma entidade “pessoa” deve conter ao menos 2 propriedades descritas pela chave “required”, além de seus valores estarem de acordo com o tipo descrito dentro da chave “properties”. Já na figura 6, além das estruturas definidas pela figura 5, é descrito uma propriedade multimídia do tipo “foto” e, na chave “links”, rotas para acesso e navegação de recursos em propriedades relacionadas.

Para validar objetos complexos em JSON, propriedades podem ser aninhadas e também representadas por subesquemas. Contudo, para evitar duplicação de estruturas, a linguagem oferece um poderoso sistema de composição e referenciamento de definições através da chave “\$ref“ e “definitions” vista a seguir na figura 7. \cite{Droettboom2015}

\begin{figure}[H]
  \centering
  \inputminted[frame=single,framesep=10pt]{javascript}{anexos/pessoa-hyper-schema-\$ref.json}
  \caption{Exemplo de JSON Hyper-Schema para Figura 4 usando referenciamento}
\end{figure}

Em casos onde a complexidade de um esquema começa a crescer, é comum a definição de subesquemas através da chave “definitions”. Desta forma, podem ser referenciados permitindo o reuso de estruturas dentro de um esquema. Vale lembrar que a chave “definitions” é apenas um mecanismo simples e util para definir esquemas em um lugar comum, entretanto, não sugerem que estas propriedades sejam validadas em um objeto ao menos que referenciadas em outras estruturas do esquema. \cite{Leach2014}

Como boa prática, é recomendado (mas não necessário) o uso da chave especial “\$schema” para determinar quando uma estrutura JSON está sendo representada em forma de esquema. A seguir, será descrito algumas das chaves especiais usadas para descrever objetos em esquemas. \cite{Droettboom2015}

\begin{table}[ht!]
  \centering
  \resizebox{\columnwidth}{!}{
    \begin{tabular}{|c|c|c|}
      \hline
      Chave & Descrição & Exemplo de Valores \\
      \hline
      \$schema & Identificador de versão & \mintinline{c}{ http://json-schema.org/draft-04/schema# } \\
      title & Nome da estrutura & \mintinline{c}{ "Uma pessoa" } \\
      description & Propósito da estrutura & \mintinline{c}{ "Dados básicos de uma pessoa" } \\
      required & Lista de prop. com presença obrigatória & \mintinline{c}{ ["nome", "sobrenome"] } \\
      properties & Prop. usadas para validar uma estrutura & \mintinline{c}{ {"nome": {"type": "string"}} } \\
      definitions & Prop. e subesquemas para referência & \mintinline{c}{ {"nome": {"type": "string"}} } \\
      type & Tipo de dado & \mintinline{c}{ "string", "number", "object" } \\
      ... & ... & ... \\
      links & Lista de Link Description Objects & \mintinline{c}{ [{"rel": "self", "href": "/{id}"}] } \\
      \hline
    \end{tabular}
  }
  \caption{Subconjunto de chaves especiais JSON Schema}
\end{table}

De certa forma, JSON Schema continua sendo uma das únicas tentativas sérias de propor uma linguagem de definição em esquemas para estruturas JSON e, lentamente, está sendo estabelecida como padrão de uso para especificação JSON. Contudo, sua definição ainda está longe de ser um padrão universal, mas já há um número crescente de aplicações que suportam JSON Schema e uma quantidade significativa de ferramentas que permitem a validação de JSON Schemas. \cite{PezoaEtAl2016}

Vale lembrar também que, segundo Leach, com o recente surgimento de grandes formatos de descrição de APIs ao longo dos últimos anos como Swagger, Blueprint e RAML. JSON Schema tem-se tornado uma ótima opção de tecnologia para descrever API's uma vez que utiliza da popularidade do formato JSON uma forma simples de descrever e disponibilizar esquemas pela web. Além disso, são extremamente nesses cenários, onde pode-se usar para evitar o recebimento de chamadas de APIs mal formadas que podem afetar o motor interno da aplicação. \cite{Leach2014} \cite{PezoaEtAl2016}

Nos próximos capítulos vamos entrar mais em detalhe sobre tipos de serviços (API web) e de que forma é possível descrever APIs para o leitura por máquinas.
