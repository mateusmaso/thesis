\section{Implementação}

A partir da definição de interface e fluxo de execução, foram implementados dez funções no total. Quatro delas responsáveis por gerar o esquema. Três para analisar o AST da consulta e outras três para transformar o AST em requisições para API de cada serviço. Além disso, três dessas funções são extensíveis através de adaptadores para análise diferentes formatos para descrição de metadados em API's. 

A seguir, é descrito brevemente as 3 categorias de funções, junto com seu objetivo e a assinatura de cada método escrito em JavaScript. \\

\textbf{Funções para composição de esquema} \\

Representam quatro funções e seu principal objetivo é compor, de forma assíncrona, um esquema GraphQL unificado a partir dos metadados de cada serviço.

\begin{figure}[H]
  \centering
  \begin{minted}[frame=single,framesep=10pt,fontsize=\small]{javascript}
  function composeSchema(
    services: [Service]
  ): Promise<GraphQLSchema>

  function buildSchema(
    schema: JSON
  ): Promise<GraphQLSchema>

  function wrapSchema(
    schema: GraphQLSchema, 
    wrapper: Wrapper
  ): Promise<GraphQLSchema>

  function deepExtendSchema(
    schemas: [GraphQLSchema]
  ): Promise<GraphQLSchema>
  \end{minted}
  \caption{Assinatura das funções para composição de esquema}
\end{figure}

\textbf{Funções para análise de AST} \\

São três funções que buscam analisar o AST gerado pela consulta GraphQL através de um algoritmo que transforma e reduz este em um AST específico e performático para cada serviço.

\begin{figure}[H]
  \centering
  \begin{minted}[frame=single,framesep=10pt,fontsize=\small]{javascript}
  function simplifyAST(
    value: AST, 
    info: JSON
  ): SimplifiedAST

  function transformAST(
    schema: JSON,
    clientSchema: GraphQLSchema, 
    ast: SimplifiedAST
  ): SimplifiedAST

  function reduceASTs(
    rootAST: SimplifiedAST, 
    asts: [SimplifiedAST]
  ): void
  \end{minted}
  \caption{Assinatura das funções para análise de AST}
\end{figure}

\textbf{Funções para busca de dados} \\

São as três últimas funções responsáveis por converter os AST's produzidos na categoria de análise em requisições para API de cada serviço.

\begin{figure}[H]
  \centering
  \begin{minted}[frame=single,framesep=10pt,fontsize=\small]{javascript}
  function unwrapAST(
    ast: SimplifiedAST, 
    schema: GraphQLSchema, 
    wrapper: Wrapper
  ): SimplifiedAST

  function fetchData(
    schema: JSON, 
    ast: SimplifiedAST, 
    url: string
  ): Promise<JSON>

  function wrapData(
    data: JSON, 
    schema: JSON, 
    wrapper: Wrapper
  ): Promise<JSON>
  \end{minted}
  \caption{Assinatura das funções para busca de dados}
\end{figure}
