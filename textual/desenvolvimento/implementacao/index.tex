\section{Implementação}

A partir do planejamento de projeto e especificação da ferramenta baseado no modelo proposto, foram implementados dez funções no total para testes em plataforma web. Quatro delas responsáveis por gerar o esquema, criando o intermediador. Três para analisar o AST das consultas e outras três para transformar o AST em requisições para API de cada serviço. Além disso, três dessas funções são extensíveis (substituíveis) através de adaptadores, sendo que apenas uma delas é pública.

A seguir, é descrito brevemente as 3 categorias de funções, junto com seu objetivo e a assinatura de cada método escrito em JavaScript. \\

\textbf{Funções para criação do esquema} \\

Representam quatro funções e seu principal objetivo é compor, de forma assíncrona, um esquema GraphQL unificado a partir das funcões de configuração de cada serviço. Sendo "composeSchema" a única função pública da ferramenta.

\begin{figure}[H]
  \centering
  \begin{minted}[frame=single,framesep=10pt,fontsize=\footnotesize]{text}
  function composeSchema(
    services: [Service]
  ): Promise<GraphQLSchema>

  function buildSchema(
    schema: JSON
  ): Promise<GraphQLSchema>

  function wrapSchema(
    schema: GraphQLSchema, 
    wrapper: Wrapper
  ): Promise<GraphQLSchema>

  function deepExtendSchema(
    schemas: [GraphQLSchema]
  ): Promise<GraphQLSchema>
  \end{minted}
  \caption{Assinatura das funções para criação do esquema}
\end{figure}

\textbf{Funções para análise de AST} \\

São três funções que buscam analisar o AST gerado por uma consulta GraphQL no esquema através de um algoritmo que simplifica, transforma e reduz em um AST específico e performático para cada serviço.

\begin{figure}[H]
  \centering
  \begin{minted}[frame=single,framesep=10pt,fontsize=\footnotesize]{text}
  function simplifyAST(
    value: AST, 
    info: JSON
  ): SimplifiedAST

  function transformAST(
    schema: JSON,
    clientSchema: GraphQLSchema, 
    ast: SimplifiedAST
  ): SimplifiedAST

  function reduceASTs(
    rootAST: SimplifiedAST, 
    asts: [SimplifiedAST]
  ): void
  \end{minted}
  \caption{Assinatura das funções para análise de AST}
\end{figure}

\textbf{Funções para busca de dados} \\

São as três últimas funções responsáveis por converter os ASTs retornados e realizar as respectivas requisições para a API de cada serviço em busca de dados.

\begin{figure}[H]
  \centering
  \begin{minted}[frame=single,framesep=10pt,fontsize=\footnotesize]{text}
  function unwrapAST(
    ast: SimplifiedAST, 
    schema: GraphQLSchema, 
    wrapper: Wrapper
  ): SimplifiedAST

  function fetchData(
    schema: JSON, 
    ast: SimplifiedAST, 
    url: string
  ): Promise<JSON>

  function wrapData(
    data: JSON, 
    schema: JSON, 
    wrapper: Wrapper
  ): Promise<JSON>
  \end{minted}
  \caption{Assinatura das funções para busca de dados}
\end{figure}
